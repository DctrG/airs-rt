<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gemini Agent</title>
  <link rel="stylesheet" href="/static/styles.css" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
    .container { max-width: 820px; margin: auto; }
    textarea { width: 100%; height: 140px; padding: 12px; font-size: 16px; }
    button { padding: 10px 14px; font-size: 16px; cursor: pointer; }
    pre { background: #f6f8fa; padding: 12px; white-space: pre-wrap; word-wrap: break-word; }
    .row { display: flex; gap: 8px; align-items: center; }
    .row > * { flex: 1; }
    .row > button { flex: 0; }
  </style>
  <script>
    // Get auth token using gcloud auth (for domain-restricted access)
    // This works when user is logged into Google with @paloaltonetworks.com account
    async function getAuthToken() {
      // Try to get token from gcloud CLI (if available)
      // For browser, we rely on the user being logged into Google
      // The domain-restricted IAM policy allows @paloaltonetworks.com users
      return null; // Browser will use cookies/session if user is logged in
    }

    async function sendPrompt() {
      const prompt = document.getElementById('prompt').value.trim();
      if (!prompt) return;
      const btn = document.getElementById('sendBtn');
      btn.disabled = true; btn.textContent = 'Thinking...';
      try {
        const headers = { 'Content-Type': 'application/json' };
        
        // Try to get auth token if available (for programmatic access)
        // For browser, domain-restricted sharing should work if user is logged in
        const token = await getAuthToken();
        if (token) {
          headers['Authorization'] = `Bearer ${token}`;
        }

        const res = await fetch('/api/chat', { 
          method: 'POST', 
          headers: headers,
          credentials: 'include', // Include cookies for auth
          body: JSON.stringify({ prompt }) 
        });
        
        if (!res.ok) {
          if (res.status === 403) {
            throw new Error('Access denied. Please ensure you are logged into Google with a @paloaltonetworks.com account.');
          }
          throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        }
        
        const data = await res.json();
        if (data.error) {
          document.getElementById('response').textContent = 'Error: ' + data.error;
        } else {
          document.getElementById('response').textContent = data.text || '';
        }
        document.getElementById('tools').textContent = JSON.stringify(data.tools || [], null, 2);
      } catch (e) {
        document.getElementById('response').textContent = 'Error: ' + e.message;
      } finally {
        btn.disabled = false; btn.textContent = 'Ask';
      }
    }
  </script>
  </head>
  <body>
    <div class="container">
      <h1>Gemini Agent</h1>
      <p>Ask questions that might require tools like web search, URL fetching, or calculations.</p>
      <div class="row">
        <textarea id="prompt" placeholder="e.g., Find the latest Gemini API updates and summarize them."></textarea>
        <button id="sendBtn" onclick="sendPrompt()">Ask</button>
      </div>
      <h3>Response</h3>
      <pre id="response"></pre>
      <h3>Tool Trace</h3>
      <pre id="tools"></pre>
    </div>
  </body>
</html>


